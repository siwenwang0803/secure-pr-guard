graph TD
    %% GitHub Integration
    GH["ğŸ”— GitHub PR"] --> |diff fetch| FD["ğŸ” Fetch Diff Agent"]
    
    %% Multi-Agent Pipeline
    FD --> |raw diff| NP["ğŸ¤– Nitpicker Agent<br/>AI Analysis + OWASP"]
    NP --> |security issues| AR["ğŸ—ï¸ Architect Agent<br/>Risk Assessment"]
    AR --> |prioritized issues| PA["ğŸ› ï¸ Patch Agent<br/>Auto-Fix Generation"]
    PA --> |draft PR| CM["ğŸ’¬ Comment Agent<br/>GitHub Integration"]
    
    %% Output Channels
    CM --> |review comment| GH
    PA --> |patch PR| PR["ğŸ“ Draft Pull Request"]
    
    %% Observability Layer
    NP -.-> |traces| OT["ğŸ“Š OpenTelemetry<br/>Instrumentation"]
    PA -.-> |metrics| OT
    CM -.-> |spans| OT
    
    %% Monitoring Stack
    OT --> |OTLP HTTP| GC["â˜ï¸ Grafana Cloud<br/>Tempo Traces"]
    GC --> |TraceQL| GB["ğŸ“ˆ Grafana Dashboard<br/>Metrics Analytics"]
    
    %% Cost Tracking
    OT -.-> |cost tokens| CSV["ğŸ“„ logs/cost.csv<br/>Local Analytics"]
    
    %% Styling
    classDef agent fill:#e1f5fe,stroke:#01579b,stroke-width:2px;
    classDef github fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px;
    classDef observability fill:#fff3e0,stroke:#ef6c00,stroke-width:2px;
    classDef storage fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px;
    
    class FD,NP,AR,PA,CM agent;
    class GH,PR github;
    class OT,GC,GB observability;
    class CSV storage; 